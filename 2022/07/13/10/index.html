
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Everyday Sonni Day :)">
    <title>[Database] 인덱스 튜닝과 설계 - Everyday Sonni Day :)</title>
    <meta name="author" content="Soeun Shim">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Soeun Shim","sameAs":[],"image":"soeun_profile.jpeg"},"articleBody":"인덱스 튜닝과 설계에 대해 알아보자.\n\n1. 인덱스 기본 구조가장 일반적으로 사용되는 BTree 인덱스 구조부터 살펴보자!\n\n\n\n\n루트와 브랜치 블록 : 하위 노드들의 데이터 값 범위를 나타내는 키값 &amp; 그 키값에 해당하는 블록을 찾는데 필요한 주소정보 를 가짐\n리프 블록 : 인덱스 키값 &amp; 그 키값에 해당하는 테이블 레코드를 찾아가는데 필요한 주소정보(ROWID) 를 가짐\n키 값이 같을 때는 ROWID 순으로 정렬된다는 사실을 기억하자!\n리프 블록은 항상 인덱스 키값 순으로 정렬되어 있기 때문에, 범위스캔(Range Scan), 정방향(Ascending), 역방향(Descending) 스캔이 둘 다 가능하도록 Double Linked list 구조로 연결되어있음\n\n\n\n\n2. 다양한 인덱스 스캔 방식\nIndex Range Scan\n\n\n\n\n루트 ~ 리프 블록까지 수직 탐색 이후, 리프블록을 필요한 범위만 스캔하는 방식\n인덱스의 가장 일반적이고 정상적인 형태의 액세스 방식\n하지만 실행계획상에 Index Range Scan 이 나타난다고 해서 항상 빠른 속도를 보장하는 것은 아님!\n스캔 범위를 얼마만큼 줄일수 있느냐, 테이블로의 액세스 횟수를 얼만큼 줄일수 있느냐가 관건이다.\nIndex Range Scan 과정을 거쳐 생성된 결과집합은 인덱스 컬럼 순으로 정렬된 상태가 되기 때문에 이러한 특징을 잘 이용하면 sort order by 연산을 생략하거나 min/max 연산을 빠르게 할수있다.\n\n\n\n\nIndex Full Scan\n\n\n\n\n수직 탐색 없이, 리프블록을 처음부터 끝까지 수평적으로 탐색하는 방식\n대개는 데이터 검색을 위한 최적의 인덱스가 없을 때 차선으로 선택됨\n인덱스 선두 컬럼이 조건절에 없으면 옵티마이저는 우선적으로 Table Full Scan 을 고려하지만, 대용량 테이블이어서 Table Full Scan 의 부담이 크다면 옵티마이저는 인덱스를 활용한 Index Full Scan 방식을 고려한다.\n하지만! 이러한 방식은 적절한 인덱스가 없어 Index Range Scan 의 차선책으로 선택된 것으로, 할수있다면 인덱스 구성을 조정해주는것이 좋다.\n\n\n\n\nIndex Unique Scan\n\n\n\n\n수직적 탐색만으로 데이터를 찾는 스캔방식\nUnique 인덱스를 ‘=’ 조건으로 탐색하는 경우에 작동한다.\n\n\n그 외\n\nIndex Skip Scan\nIndex Fast Full Scan\nIndex Range Scan Descending\n등..\n\n\n\n\n3. 인덱스 튜닝인덱스를 정상적으로 사용하려면, 범위 스캔 시작지점을 찾기 위해 루트~리프 블록 까지의 수직적 탐색 과정을 거쳐야한다. 인덱스 선두 컬럼이 조건절에 사용되지 않으면 범위 스캔을 위한 시작점을 찾을수 없어 옵티마이저는 인덱스 Full 스캔하거나, 테이블 Full 스캔하는 방식을 선택한다.\n인덱스 선두 컬럼이 조건절에 사용 되더라도 Range 스캔이 불가능하거나 , 아예 인덱스를 사용하지 못하는 경우가 어떤경우인지 살펴보자!\n3-1. Index Range Scan 이 불가능하거나 아예 인덱스 사용이 불가능 한 경우\n조건절에서 인덱스 컬럼을 가공했을 경우\n123select *from 업체where substr(업체, 1, 2) = &#x27;대한&#x27;\n부정형 비교를 사용했을 경우\n123select *from 고객where 직업 != &#x27;학생&#x27;\n위 경우 정상적인 Index Range Scan 이 불가능하다. Index Full Scan 은 가능!\n12345678910111213141516[인덱스 컬럼 가공 사례]1.select *from 업체where substr(업체, 1, 2) = &#x27;대한&#x27;2.select *from 사원where 월급여 * 12 = 360000003.select *from 주문where to_char(일시, &#x27;yyyymmdd&#x27;) = &#x27;20220519&#x27;\n1234567891011121314151617[튜닝 방안]1.select *from 업체where 업체명 like &#x27;대한%&#x27;2.select *from 사원where 월급여 = 36000000/123.select *from 주문where 일시 &gt;= to_date(&#x27;20220519&#x27;, &#x27;yyyymmdd&#x27;)and 일시 &lt; to_date(&#x27;20220519&#x27;, &#x27;yyyymmdd&#x27;) + 1\n묵시적 형변환을 사용했을 경우사용자가 명시적으로 컬럼을 가공하지 않더라도, 조건절에서 비교되는 두 값의 데이터 타입이 다르면 내부적으로 형변환이 일어난다.\n\n문자열 → 숫자로 형변환됨\n문자형 → 날짜형으로 형변환됨1select * from emp where cdeptno = 20\ncdeptno가 인덱스 컬럼이고, 문자열 컬럼이다. 숫자형 20 으로 값 비교를 했을시 cdeptno 컬럼이 형변환이 되기 때문에 Full Scan 을 하게된다.\n데이터 타입간의 묵시적 형변환은 사용자가 코딩을 쉽게 하도록 도울 목적으로 DBMS 가 제공하는 기능인데, 위와같은 부작용을 피하려면!\n굳이 형변환 우선순위를 외울 필요없이 인덱스 컬럼 데이터 타입에 맞춰서 값비교를 하면 된다!1select * from emp where cdeptno = &#x27;20&#x27;\n\n\n\n\n\n\n\n3-2. 테이블 Random 액세스 최소화emp 테이블에 [deptno + job] 순으로 구성된 인덱스 하나만 있는 상태에서 아래 쿼리를 수행하려한다.\n1234select *from empwhere deptno = 30and sal &gt;= 2000\n\n\n\n위 조건을 만족하는 사원은 단 한명 뿐인데, 이를 찾기위해 테이블 액세스는 6번 발생한다.\n인덱스 구성을 [deptno + sal] 순으로 바꾸면 좋겠지만 실 운형 환경에서는 기존인덱스를 사용하는 쿼리가 있거나 등의 이유로 인덱스 구성을 함부로 바꾸기가 쉽지않다.\n\n\n\n\n이때 기존 인덱스에 sal 컬럼을 추가하는 것만으로 큰 효과를 거둘 수 있다. 인덱스 스캔량은 줄지 않지만 테이블 Random 액세스 횟수를 줄여주기 때문이다.\n\n3-3. 인덱스 스캔범위 최소화인덱스 선행 컬럼이 범위조건일 때는 상당한 비효율을 발생시킨다.\n\n인덱스 구성 컬럼이 조건절에서 모두 ‘=’ 조건으로 비교되면, 리프 블록을 스캔하면서 읽은 레코드는 모두 테이블 엑세스로 이어지기 때문에 읽고서 버리는 레코드가 하나도 없다.\n인덱스 컬럼중 일부가 ‘=’ 조건이 아니거나 조건절에서 생략되더라도 그것이 뒤쪽 컬럼일 때는 비효율이 없다.\n\n아래와 같은 SQL 일 경우 인덱스 순서에 따른 효율성을 알아보자.\n1234select * from 매물아파트매매where 아파트시세코드 = &#x27;A01011350900056&#x27;and 평형 = &#x27;59&#x27; and 평형타입 = &#x27;A&#x27;and 인터넷매물 between 1 and 2\n인덱스가 [아파트시세코드 + 평형 + 평형타입 + 인터넷 매물] 순으로 구성된 상황에서는인터넷 매물이 between 조건이지만 선행컬럼들이 모두 ‘=’ 조건이기 때문에 전혀 비효율없이 조건을 만족하는 2건을 빠르게 찾는다.\n인덱스 구성이 [인터넷메물 + 아파트 시세코드 + 평형 + 평형타입] 순으로 구성되어있다면인덱스 스캔범위가 넓어진다. 따라서 조건을 만족하지 않는 레코드 까지 스캔하고서 버려야하는 비효율이 생긴다.\n\n4. 인덱스 설계결합 인덱스 구성을 위한 기본 공식\n\n인덱스 선두 컬럼이 조건절에 반드시 사용되어야만 한다. 아니면 적어도 자주 사용되는 컬럼들을 선정하자.\n‘=’ 조건으로 자주 조회되는 컬럼을 앞쪽에 두자.\nSort Operation 을 생략하도록 하기 위해 컬럼을 추가하자. 인덱스는 항상 정렬상태를 유지하므로 order by, group by 를 위한 Sort 연산을 생략할 수 있도록 해준다.\n인덱스를 통해 Sort 연산을 대체하려면, 인덱스 컬럼 구성과 같은 순서로 누락없이 (뒤쪽 컬럼이 누락되는것은 상관없음) order by 절에 기술해야한다.\n단, 조건절에서 ‘=’연산자로 비교된 컬럼이 있다면 그 컬럼은 order by 절에서 누락되거나 다른 인덱스와 다른 순서로 기술하더라도 상관 없다. 이 규칙은 group by 에도 똑같이 적용된다.\n\n\n선택도가 충분히 낮은지를 꼭 판단하자.\n인덱스를 스캔하면서 테이블을 액세스 하는 양이 일정 수준을 넘는 순간 Table Full Scan 보다 오히려 늦어지기 대문에 선택도가 높은 인덱스는 생성해봤자 효용가치가 없다.\n\n선택도란 ?\n\n 전체 대상 레코드 중에서 특정 조건에 의해 선택될 것이라 예상되는 레코드 비율\n\n\n\n추가적인 고려사항?\n인덱스 스캔외에도 고려해야할 사항이 훨씬 많다.\n쿼리 수행 빈도\n업무상 중요도\n클러스터링 팩터\n데이터양\nDML 부하 (기존 인덱스 개수, 초당 DML 발생량, 자주 갱신되는 컬럼 포함 여부 등)\n저장 공간\n인덱스 관리 비용 등\n\n\n\n\n\n인덱스 설계는 공식이 아닌 전략과 선택의 문제이다.시스템 전체적인 관점에서 대안 전략들을 수립하고 그중 최적을 선택할 수 있는 고도의 기술력과 경험이 요구되기 때문에 어렵다. 개별 쿼리 성능을 높일 뿐만아니라, 생성되는 인덱스 개수를 최소화 함으로써 DML 부하를 줄이는 것이 중요한 목표이어야 한다.\n\n오늘의 결론!옵티마이저는 DBMS의 똑똑한 핵심 엔진이지만! 어디까지나 사용자가 적절한 옵티마이징 팩터(효과적으로 구성된 인덱스, 클러스터링, 파티셔닝 등) 를 제공하지 않는다면 결코 좋은 실행계획을 수립할 수 없다는 것을 인지하자!\n\n\nReference서적 : SQL 전문가 가이드\n\n","dateCreated":"2022-07-13T17:25:45+09:00","dateModified":"2022-08-02T18:48:45+09:00","datePublished":"2022-07-13T17:25:45+09:00","description":"","headline":"[Database] 인덱스 튜닝과 설계","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://sonniday.github.io/2022/07/13/10/"},"publisher":{"@type":"Organization","name":"Soeun Shim","sameAs":[],"image":"soeun_profile.jpeg","logo":{"@type":"ImageObject","url":"soeun_profile.jpeg"}},"url":"https://sonniday.github.io/2022/07/13/10/","keywords":"Database"}</script>
    <meta name="description" content="인덱스 튜닝과 설계에 대해 알아보자.  1. 인덱스 기본 구조가장 일반적으로 사용되는 BTree 인덱스 구조부터 살펴보자!     루트와 브랜치 블록 : 하위 노드들의 데이터 값 범위를 나타내는 키값 &amp; 그 키값에 해당하는 블록을 찾는데 필요한 주소정보 를 가짐 리프 블록 : 인덱스 키값 &amp; 그 키값에 해당하는 테이블 레코드를 찾아가는데 필요">
<meta property="og:type" content="blog">
<meta property="og:title" content="[Database] 인덱스 튜닝과 설계">
<meta property="og:url" content="https://sonniday.github.io/2022/07/13/10/index.html">
<meta property="og:site_name" content="Everyday Sonni Day :)">
<meta property="og:description" content="인덱스 튜닝과 설계에 대해 알아보자.  1. 인덱스 기본 구조가장 일반적으로 사용되는 BTree 인덱스 구조부터 살펴보자!     루트와 브랜치 블록 : 하위 노드들의 데이터 값 범위를 나타내는 키값 &amp; 그 키값에 해당하는 블록을 찾는데 필요한 주소정보 를 가짐 리프 블록 : 인덱스 키값 &amp; 그 키값에 해당하는 테이블 레코드를 찾아가는데 필요">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://sonniday.github.io/img/10-1.JPG">
<meta property="og:image" content="https://sonniday.github.io/img/10-2.JPG">
<meta property="og:image" content="https://sonniday.github.io/img/10-3-1.JPG">
<meta property="og:image" content="https://sonniday.github.io/img/10-4-1.JPG">
<meta property="og:image" content="https://sonniday.github.io/img/10-5.JPG">
<meta property="og:image" content="https://sonniday.github.io/img/10-6.JPG">
<meta property="og:image" content="https://sonniday.github.io/img/10-7-1.JPG">
<meta property="og:image" content="https://sonniday.github.io/img/10-8.JPG">
<meta property="og:image" content="https://sonniday.github.io/img/10-9.JPG">
<meta property="article:published_time" content="2022-07-13T08:25:45.000Z">
<meta property="article:modified_time" content="2022-08-02T09:48:45.609Z">
<meta property="article:author" content="Soeun Shim">
<meta property="article:tag" content="Database">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://sonniday.github.io/img/10-1.JPG">
    
    
        
    
    
        <meta property="og:image" content="https://sonniday.github.io/assets/images/soeun_profile.jpeg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Everyday Sonni Day :)
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/soeun_profile.jpeg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/soeun_profile.jpeg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Soeun Shim</h4>
                
                    <h5 class="sidebar-profile-bio"><p>My Tech Diary</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            [Database] 인덱스 튜닝과 설계
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2022-07-13T17:25:45+09:00">
	
		    Jul 13, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Database/">Database</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>인덱스 튜닝과 설계에 대해 알아보자.</p>
<hr>
<h3 id="1-인덱스-기본-구조"><a href="#1-인덱스-기본-구조" class="headerlink" title="1. 인덱스 기본 구조"></a>1. 인덱스 기본 구조</h3><p>가장 일반적으로 사용되는 BTree 인덱스 구조부터 살펴보자!</p>
<center><img src="/img/10-1.JPG" alt="10-1" height="400"></center>
<br/>

<ul>
<li>루트와 브랜치 블록 : 하위 노드들의 데이터 값 범위를 나타내는 키값 &amp; 그 키값에 해당하는 블록을 찾는데 필요한 주소정보 를 가짐</li>
<li>리프 블록 : 인덱스 키값 &amp; 그 키값에 해당하는 테이블 레코드를 찾아가는데 필요한 주소정보(ROWID) 를 가짐<ul>
<li>키 값이 같을 때는 ROWID 순으로 정렬된다는 사실을 기억하자!</li>
<li>리프 블록은 항상 인덱스 키값 순으로 정렬되어 있기 때문에, 범위스캔(Range Scan), 정방향(Ascending), 역방향(Descending) 스캔이 둘 다 가능하도록 Double Linked list 구조로 연결되어있음</li>
</ul>
</li>
</ul>
<hr>
<h3 id="2-다양한-인덱스-스캔-방식"><a href="#2-다양한-인덱스-스캔-방식" class="headerlink" title="2. 다양한 인덱스 스캔 방식"></a>2. 다양한 인덱스 스캔 방식</h3><ol>
<li><p><strong>Index Range Scan</strong></p>
<center><img src="/img/10-2.JPG" alt="10-2" height="200"></center>
<br/>

<ul>
<li>루트 ~ 리프 블록까지 수직 탐색 이후, 리프블록을 필요한 범위만 스캔하는 방식</li>
<li>인덱스의 가장 일반적이고 정상적인 형태의 액세스 방식</li>
<li>하지만 실행계획상에 Index Range Scan 이 나타난다고 해서 항상 빠른 속도를 보장하는 것은 아님!<ul>
<li>스캔 범위를 얼마만큼 줄일수 있느냐, 테이블로의 액세스 횟수를 얼만큼 줄일수 있느냐가 관건이다.</li>
<li>Index Range Scan 과정을 거쳐 생성된 결과집합은 인덱스 컬럼 순으로 정렬된 상태가 되기 때문에 이러한 특징을 잘 이용하면 sort order by 연산을 생략하거나 min/max 연산을 빠르게 할수있다.</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Index Full Scan</strong></p>
<center><img src="/img/10-3-1.JPG" alt="10-3" height="200"></center>
<br/>

<ul>
<li>수직 탐색 없이, 리프블록을 처음부터 끝까지 수평적으로 탐색하는 방식</li>
<li>대개는 데이터 검색을 위한 최적의 인덱스가 없을 때 차선으로 선택됨</li>
<li>인덱스 선두 컬럼이 조건절에 없으면 옵티마이저는 우선적으로 Table Full Scan 을 고려하지만, 대용량 테이블이어서 Table Full Scan 의 부담이 크다면 옵티마이저는 인덱스를 활용한 Index Full Scan 방식을 고려한다.<ul>
<li>하지만! 이러한 방식은 적절한 인덱스가 없어 Index Range Scan 의 차선책으로 선택된 것으로, 할수있다면 인덱스 구성을 조정해주는것이 좋다.</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Index Unique Scan</strong></p>
<center><img src="/img/10-4-1.JPG" alt="10-4" height="200"></center>
<br/>

<ul>
<li>수직적 탐색만으로 데이터를 찾는 스캔방식</li>
<li>Unique 인덱스를 ‘=’ 조건으로 탐색하는 경우에 작동한다.</li>
</ul>
</li>
<li><p><strong>그 외</strong></p>
<ul>
<li>Index Skip Scan</li>
<li>Index Fast Full Scan</li>
<li>Index Range Scan Descending</li>
<li>등..</li>
</ul>
</li>
</ol>
<hr>
<h3 id="3-인덱스-튜닝"><a href="#3-인덱스-튜닝" class="headerlink" title="3. 인덱스 튜닝"></a>3. 인덱스 튜닝</h3><p>인덱스를 정상적으로 사용하려면, 범위 스캔 시작지점을 찾기 위해 루트~리프 블록 까지의 수직적 탐색 과정을 거쳐야한다. 인덱스 선두 컬럼이 조건절에 사용되지 않으면 범위 스캔을 위한 시작점을 찾을수 없어 옵티마이저는 인덱스 Full 스캔하거나, 테이블 Full 스캔하는 방식을 선택한다.</p>
<p>인덱스 선두 컬럼이 조건절에 사용 되더라도 Range 스캔이 불가능하거나 , 아예 인덱스를 사용하지 못하는 경우가 어떤경우인지 살펴보자!</p>
<h4 id="3-1-Index-Range-Scan-이-불가능하거나-아예-인덱스-사용이-불가능-한-경우"><a href="#3-1-Index-Range-Scan-이-불가능하거나-아예-인덱스-사용이-불가능-한-경우" class="headerlink" title="3-1. Index Range Scan 이 불가능하거나 아예 인덱스 사용이 불가능 한 경우"></a>3-1. Index Range Scan 이 불가능하거나 아예 인덱스 사용이 불가능 한 경우</h4><ol>
<li><p><strong>조건절에서 인덱스 컬럼을 가공했을 경우</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> 업체</span><br><span class="line"><span class="keyword">where</span> substr(업체, <span class="number">1</span>, <span class="number">2</span>) <span class="operator">=</span> <span class="string">&#x27;대한&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>부정형 비교를 사용했을 경우</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> 고객</span><br><span class="line"><span class="keyword">where</span> 직업 <span class="operator">!=</span> <span class="string">&#x27;학생&#x27;</span></span><br></pre></td></tr></table></figure>
<p>위 경우 정상적인 Index Range Scan 이 불가능하다. Index Full Scan 은 가능!</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[인덱스 컬럼 가공 사례]</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> 업체</span><br><span class="line"><span class="keyword">where</span> substr(업체, <span class="number">1</span>, <span class="number">2</span>) <span class="operator">=</span> <span class="string">&#x27;대한&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> 사원</span><br><span class="line"><span class="keyword">where</span> 월급여 <span class="operator">*</span> <span class="number">12</span> <span class="operator">=</span> <span class="number">36000000</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> 주문</span><br><span class="line"><span class="keyword">where</span> to_char(일시, <span class="string">&#x27;yyyymmdd&#x27;</span>) <span class="operator">=</span> <span class="string">&#x27;20220519&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[튜닝 방안]</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> 업체</span><br><span class="line"><span class="keyword">where</span> 업체명 <span class="keyword">like</span> <span class="string">&#x27;대한%&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> 사원</span><br><span class="line"><span class="keyword">where</span> 월급여 <span class="operator">=</span> <span class="number">36000000</span><span class="operator">/</span><span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> 주문</span><br><span class="line"><span class="keyword">where</span> 일시 <span class="operator">&gt;=</span> to_date(<span class="string">&#x27;20220519&#x27;</span>, <span class="string">&#x27;yyyymmdd&#x27;</span>)</span><br><span class="line"><span class="keyword">and</span> 일시 <span class="operator">&lt;</span> to_date(<span class="string">&#x27;20220519&#x27;</span>, <span class="string">&#x27;yyyymmdd&#x27;</span>) <span class="operator">+</span> <span class="number">1</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>묵시적 형변환을 사용했을 경우</strong><br>사용자가 명시적으로 컬럼을 가공하지 않더라도, 조건절에서 비교되는 두 값의 데이터 타입이 다르면 내부적으로 형변환이 일어난다.</p>
<ul>
<li>문자열 → 숫자로 형변환됨</li>
<li>문자형 → 날짜형으로 형변환됨<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> cdeptno <span class="operator">=</span> <span class="number">20</span></span><br></pre></td></tr></table></figure></li>
<li>cdeptno가 인덱스 컬럼이고, 문자열 컬럼이다. 숫자형 20 으로 값 비교를 했을시 cdeptno 컬럼이 형변환이 되기 때문에 Full Scan 을 하게된다.<img src="/img/10-5.JPG" alt="10-5" height="200"></li>
<li>데이터 타입간의 묵시적 형변환은 사용자가 코딩을 쉽게 하도록 도울 목적으로 DBMS 가 제공하는 기능인데, 위와같은 부작용을 피하려면!<ul>
<li>굳이 형변환 우선순위를 외울 필요없이 인덱스 컬럼 데이터 타입에 맞춰서 값비교를 하면 된다!<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> cdeptno <span class="operator">=</span> <span class="string">&#x27;20&#x27;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="3-2-테이블-Random-액세스-최소화"><a href="#3-2-테이블-Random-액세스-최소화" class="headerlink" title="3-2. 테이블 Random 액세스 최소화"></a>3-2. 테이블 Random 액세스 최소화</h4><p>emp 테이블에 [deptno + job] 순으로 구성된 인덱스 하나만 있는 상태에서 아래 쿼리를 수행하려한다.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> emp</span><br><span class="line"><span class="keyword">where</span> deptno <span class="operator">=</span> <span class="number">30</span></span><br><span class="line"><span class="keyword">and</span> sal <span class="operator">&gt;=</span> <span class="number">2000</span></span><br></pre></td></tr></table></figure>
<center><img src="/img/10-6.JPG" alt="10-6" height="300"></center>

<ul>
<li>위 조건을 만족하는 사원은 단 한명 뿐인데, 이를 찾기위해 테이블 액세스는 6번 발생한다.</li>
<li>인덱스 구성을 [deptno + sal] 순으로 바꾸면 좋겠지만 실 운형 환경에서는 기존인덱스를 사용하는 쿼리가 있거나 등의 이유로 인덱스 구성을 함부로 바꾸기가 쉽지않다.</li>
</ul>
<center><img src="/img/10-7-1.JPG" alt="10-7" height="300"></center>

<ul>
<li>이때 기존 인덱스에 sal 컬럼을 추가하는 것만으로 큰 효과를 거둘 수 있다. 인덱스 스캔량은 줄지 않지만 테이블 Random 액세스 횟수를 줄여주기 때문이다.</li>
</ul>
<h4 id="3-3-인덱스-스캔범위-최소화"><a href="#3-3-인덱스-스캔범위-최소화" class="headerlink" title="3-3. 인덱스 스캔범위 최소화"></a>3-3. 인덱스 스캔범위 최소화</h4><p>인덱스 선행 컬럼이 범위조건일 때는 상당한 비효율을 발생시킨다.</p>
<ul>
<li>인덱스 구성 컬럼이 조건절에서 모두 ‘=’ 조건으로 비교되면, 리프 블록을 스캔하면서 읽은 레코드는 모두 테이블 엑세스로 이어지기 때문에 읽고서 버리는 레코드가 하나도 없다.</li>
<li>인덱스 컬럼중 일부가 ‘=’ 조건이 아니거나 조건절에서 생략되더라도 그것이 뒤쪽 컬럼일 때는 비효율이 없다.</li>
</ul>
<p>아래와 같은 SQL 일 경우 인덱스 순서에 따른 효율성을 알아보자.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 매물아파트매매</span><br><span class="line"><span class="keyword">where</span> 아파트시세코드 <span class="operator">=</span> <span class="string">&#x27;A01011350900056&#x27;</span></span><br><span class="line"><span class="keyword">and</span> 평형 <span class="operator">=</span> <span class="string">&#x27;59&#x27;</span> <span class="keyword">and</span> 평형타입 <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span></span><br><span class="line"><span class="keyword">and</span> 인터넷매물 <span class="keyword">between</span> <span class="number">1</span> <span class="keyword">and</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>인덱스가 [아파트시세코드 + 평형 + 평형타입 + 인터넷 매물] 순으로 구성된 상황에서는<br><img src="/img/10-8.JPG" alt="10-8" height="300">인터넷 매물이 between 조건이지만 선행컬럼들이 모두 ‘=’ 조건이기 때문에 전혀 비효율없이 조건을 만족하는 2건을 빠르게 찾는다.</p>
<p>인덱스 구성이 [인터넷메물 + 아파트 시세코드 + 평형 + 평형타입] 순으로 구성되어있다면<br><img src="/img/10-9.JPG" alt="10-9" height="300">인덱스 스캔범위가 넓어진다. 따라서 조건을 만족하지 않는 레코드 까지 스캔하고서 버려야하는 비효율이 생긴다.</p>
<hr>
<h3 id="4-인덱스-설계"><a href="#4-인덱스-설계" class="headerlink" title="4. 인덱스 설계"></a>4. 인덱스 설계</h3><p>결합 인덱스 구성을 위한 기본 공식</p>
<ol>
<li>인덱스 선두 컬럼이 조건절에 반드시 사용되어야만 한다. 아니면 적어도 자주 사용되는 컬럼들을 선정하자.</li>
<li>‘=’ 조건으로 자주 조회되는 컬럼을 앞쪽에 두자.</li>
<li>Sort Operation 을 생략하도록 하기 위해 컬럼을 추가하자. 인덱스는 항상 정렬상태를 유지하므로 order by, group by 를 위한 Sort 연산을 생략할 수 있도록 해준다.<ul>
<li>인덱스를 통해 Sort 연산을 대체하려면, 인덱스 컬럼 구성과 같은 순서로 누락없이 (뒤쪽 컬럼이 누락되는것은 상관없음) order by 절에 기술해야한다.</li>
<li>단, 조건절에서 ‘=’연산자로 비교된 컬럼이 있다면 그 컬럼은 order by 절에서 누락되거나 다른 인덱스와 다른 순서로 기술하더라도 상관 없다. 이 규칙은 group by 에도 똑같이 적용된다.</li>
</ul>
</li>
<li>선택도가 충분히 낮은지를 꼭 판단하자.<ol>
<li>인덱스를 스캔하면서 테이블을 액세스 하는 양이 일정 수준을 넘는 순간 Table Full Scan 보다 오히려 늦어지기 대문에 선택도가 높은 인덱스는 생성해봤자 효용가치가 없다.<details>
<summary>
선택도란 ?
</summary>
 전체 대상 레코드 중에서 특정 조건에 의해 선택될 것이라 예상되는 레코드 비율
</details></li>
</ol>
</li>
<li>추가적인 고려사항?<ol>
<li><strong>인덱스 스캔외에도 고려해야할 사항이 훨씬 많다.</strong><ol>
<li>쿼리 수행 빈도</li>
<li>업무상 중요도</li>
<li>클러스터링 팩터</li>
<li>데이터양</li>
<li>DML 부하 (기존 인덱스 개수, 초당 DML 발생량, 자주 갱신되는 컬럼 포함 여부 등)</li>
<li>저장 공간</li>
<li>인덱스 관리 비용 등</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>인덱스 설계는 공식이 아닌 전략과 선택의 문제이다.<br><strong>시스템 전체적인 관점에서 대안 전략들을 수립하고 그중 최적을 선택할 수 있는 고도의 기술력과 경험이 요구되기 때문에 어렵다. 개별 쿼리 성능을 높일 뿐만아니라, 생성되는 인덱스 개수를 최소화 함으로써 DML 부하를 줄이는 것이 중요한 목표이어야 한다.</strong></p>
<hr>
<h4 id="오늘의-결론"><a href="#오늘의-결론" class="headerlink" title="오늘의 결론!"></a>오늘의 결론!</h4><p>옵티마이저는 DBMS의 똑똑한 핵심 엔진이지만! 어디까지나 사용자가 적절한 옵티마이징 팩터(효과적으로 구성된 인덱스, 클러스터링, 파티셔닝 등) 를 제공하지 않는다면 결코 좋은 실행계획을 수립할 수 없다는 것을 인지하자!</p>
<hr>
<blockquote>
<p>Reference<br>서적 : SQL 전문가 가이드</p>
</blockquote>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/Database/" rel="tag">Database</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/05/11/9/"
                    data-tooltip="[Database] 정규화와 반정규화의 성능"
                    aria-label="NEXT: [Database] 정규화와 반정규화의 성능"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://sonniday.github.io/2022/07/13/10/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://sonniday.github.io/2022/07/13/10/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://sonniday.github.io/2022/07/13/10/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2022 Soeun Shim. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/05/11/9/"
                    data-tooltip="[Database] 정규화와 반정규화의 성능"
                    aria-label="NEXT: [Database] 정규화와 반정규화의 성능"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://sonniday.github.io/2022/07/13/10/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://sonniday.github.io/2022/07/13/10/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://sonniday.github.io/2022/07/13/10/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://sonniday.github.io/2022/07/13/10/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://sonniday.github.io/2022/07/13/10/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://sonniday.github.io/2022/07/13/10/"
                        aria-label="Share on Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/soeun_profile.jpeg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Soeun Shim</h4>
        
            <div id="about-card-bio"><p>My Tech Diary</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Software Engineer</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                South Korea / Seoul
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
